p←↑⍎¨⊃⎕NGET'p6.txt'1
g←{1=≢z←⍸t=⌊/t←+/|p-⍤1⊢⍵:⊃z⋄¯1}¨⍳⌈⌿p
sort←{(⊂⍋⍵)⌷⍵}
a←sort{⍺,≢⍵}⌸,g
b←sort{⍺,≢⍵}⌸,1 1↓¯1 ¯1↓g
⌈/⊢/↑(↓a)∩↓b ⍝ part 1
+/,{10000>+/,|p-⍤1⊢⍵}¨⍳⌈⌿p ⍝ part 2

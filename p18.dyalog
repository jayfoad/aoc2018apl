⎕IO←0
p←↑⊃⎕NGET'p18.txt' 1
f←{(⍺='.')∧2<+/⍵='|':'|' ⋄ (⍺='|')∧2<+/⍵='#':'#' ⋄ (⍺='#')∧(1=+/⍵='#')∨0=+/⍵='|':'.' ⋄ ⍺}
g←{⍵f⍤¯2{,⍵}⌺3 3⊢⍵}
v←{×/+/'|#'∘.=,⍵} ⍝ value
v g⍣10⊢p ⍝ part 1
v ⍬{(≢⍺)≠n←⍺⍳⊂⍵:⍺⊃⍨n+((≢⍺)-n)|1E9-n ⋄ (⍺,⊂⍵)∇g ⍵}p ⍝ part 2

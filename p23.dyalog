⎕IO←0
p←↑⍎¨¨'-?\d+'⎕S'&'¨⊃⎕NGET'p23.txt'1
r←⊢/p ⋄ p←0 ¯1↓p
+/{(⍵⌷r)≥+/|p-⍤1⊢⍵⌷p}⊃⍒r ⍝ part 1

h←{+/r≥+/0⌈⍺-⍨|p-⍤1⊢⍵}¨
f←{(2*⌈2⍟⌈/,|p)(⍵ g)⊂3/0}
g←{0=≢w←⍵/⍨⍺⍺≤t←⍺ h ⍵:f⌈/t ⋄ ⍺=0:w ⋄ ⍺=1:0 ∇,(¯1+,⍳3/3)∘.+w ⋄ (⍺÷2)∇,((⍺÷2)×¯1*,⍳3/2)∘.+w}
⌊/+/¨f≢p ⍝ part 2
